<!DOCTYPE html>
<html>
<head>
  <title>LO Tech: Inventory</title>
  <script type="text/javascript" src="jquery-3.3.1.min.js"></script>
  <script type="text/javascript" src="jquery.tablesorter.min.js"></script>
  <link rel="stylesheet" type="text/css" href="index2.css">
  <link rel="stylesheet" type="text/css" href="themes/blue/style.css">
  <script type="text/javascript" src="tablefilter/tablefilter.js"></script>
  <script>
    function find() {
      // Declare variables 
      var input, filter, table, tr, td, i;
      input = document.getElementById("SearchBar");
      filter = input.value.toUpperCase();
      table = document.getElementById("table");
      tr = table.getElementsByTagName("tr");

      // Loop through all table rows, and hide those who don't match the search query
      for (i = 0; i < tr.length; i++) {
        td = tr[i].getElementsByTagName("td")[0];
        if (td) {
          if (td.innerHTML.toUpperCase().indexOf(filter) > -1) {
            tr[i].style.display = "";
          } else {
            tr[i].style.display = "none";
          }
        } 
      }
    }
  </script>
</head>
  <body>
    
    <div id="blackout">
      <div id="movingbox"></div>
      <h1>Please Wait, Loading</h1>
    </div>
    



    <input type="text" id="SearchBar" onkeyup="find()" placeholder="Search for items">
    <table id="table" class="container tablesorter">
      <thead>
        <tr>
          <th><h1>Name</h1></th>
          <th><h1>ID</h1></th>
          <th><h1>Category</h1></th>
          <th><h1>Description</h1></th>
          <th><h1>More Info</h1></th>
        </tr>
      </thead>
        <tbody id="datatable">
        </tbody>
        <h1 id="title">LO Tech Inventory</h1>
    </table>



    <div id="extraData">
      <!-- LOAD INFO ABOUT EACH THING HERE -->
      
    </div>




    <script src="load_sheetsu.js"></script>
    <script type="text/javascript">

      function makeNewElementFromElement( tag, elem ) {

          var newElem = document.createElement(tag),
              i, prop,
              attr = elem.attributes,
              attrLen = attr.length;

          // Copy children 
          elem = elem.cloneNode(true);
          while (elem.firstChild) {
              newElem.appendChild(elem.firstChild);
          }

          // Copy DOM properties
          for (i in elem) {
              try {
                  prop = elem[i];
                  if (prop && i !== 'outerHTML' && (typeof prop === 'string' || typeof prop === 'number')) {
                      newElem[i] = elem[i];
                  }
              } catch(e) { /* some props throw getter errors */ }
          }

          // Copy attributes
          for (i = 0; i < attrLen; i++) {
              newElem.setAttribute(attr[i].nodeName, attr[i].nodeValue);
          }

          // Copy inline CSS
          newElem.style.cssText = elem.style.cssText;

          return newElem;
      }



      

      function loadbuttons() {
        /*
        [].forEach.call(document.querySelectorAll('.Yes'), function (el) {
          el.style.display = 'inherit';
        });
        */
      };

      function vanish() {
        $('.rent.No').children('.checkout').hide()
        $('.rent.Yes').children('.rentee,.due').hide()
        $(document.getElementsByClassName('N/A')).children('*').hide()

        $('.exData').hide()
        $('.exData').css('zIndex', 10)
      };

      function show(el) {
        $("#"+el).fadeIn()
      };
      function hide(el) {
        $("#"+el).fadeOut()
      };

      function test() {
          $('.fltrow').children().each( function convert() {


          //fltrow = $('.fltrow')
          //for (i in fltrow) {
            el = makeNewElementFromElement('th', this)
            $('.fltrow').append(el)
            $(this).remove()
          });
          
          
        };

    </script>


















    <script type="text/javascript">
    function sheetLoaded(spreadsheetdata) {
     // do something with spreadsheet data here
     var headers = []
     //console.log(spreadsheetdata)
     console.log(spreadsheetdata.feed.entry);
     //console.log(spreadsheetdata.feed.entry.length)
     var cells = {}

     for (var i = 0; i < spreadsheetdata.feed.entry.length; i++) {
        cell = spreadsheetdata.feed.entry[i].title.$t
        content = spreadsheetdata.feed.entry[i].content.$t
        len = cell.length
        if (len === 2) {
          if (cell.substring(1) === "1") {
            //console.log(cell)
            headers.push(content)
          }
        }
     }

     for (i in spreadsheetdata.feed.entry) {
      x = spreadsheetdata.feed.entry[i]
       cell = x.title.$t
       num = cell.substring(1)
       letter = cell.substring(0, 1)
       content = x.content.$t

       if (num in cells) {} else {
         cells[num] = {}
       }

       cells[num][letter] = content

     }
     console.log("=======Cells=======")
     console.log(cells)
     console.log("=======Headers=======")
     console.log(headers)
     console.log("==============")

     tout = ""
     dout = ""
     
     for (i in cells) {
      if (i !== "1") {
        cell = cells[i]

        crow = {}
        
        crow.name = cell.B
        crow.id = cell.A
        crow.desc = cell.C
        crow.exDesc = cell.D
        crow.img = cell.E
        crow.loc = cell.F

        crow.avail = cell.K
        crow.rentee = cell.L
        crow.due = cell.M
        crow.group = cell.G

        //console.log(crow)

        for (l in crow) {
          if (crow[l] === undefined) {
            crow[l] = ""
          }
        }

        if (crow.img === "") {
          crow.img = undefined
        }

        if (crow.exDesc === "") {
          crow.exDesc = crow.desc
        }

        //console.log(name)

        tout += "<tr class='trowid"+crow.id+"'><td>"+crow.name+"</td><td>"+crow.id+"</td><td>"+crow.group+"</td><td>"+crow.desc+"</td><td onclick='show("+'"'+crow.id+'"'+");'>[Click Here]</td></tr>"
        
        dout += "<div id='"+crow.id+"' class='exData drowid"+crow.id+"'><h1>"+crow.name+"</h1><h2>"+crow.id+"</h2><img src="+crow.img+" class='eximg'><p class='exDesc'>"+crow.exDesc+"</p><h3 class='location'>Last known location: "+crow.loc+"</h3><div class='rent "+crow.avail+"'><h3>Available: "+crow.avail+"</h3><p class='rentee'>Taken Out by: "+crow.rentee+"</p><p class='due'>Due: "+crow.due+"</p><button class='checkout'>Check Out</button></div><img src='Fancy X.png' class='closeX' onclick='hide("+'"'+crow.id+'"'+")'></div>"

      }
     }

      $('#datatable').append(tout)
      $('#extraData').append(dout)
      $('img[src="undefined"]').remove()
      $('.trowid').remove()
      $('.drowid').remove()
      //console.log(dout)


      //console.log("Exists!");
      loadbuttons();
      vanish();
      //$("#table").tablesorter({sortList:[[1,0]]});
      $("#blackout").fadeOut();

      
     }
  </script>


  <!--
  <script src="https://spreadsheets.google.com/feeds/cells/1FS7Q15EEYDFcT5_vcPkCE85OhD0tF4b7kksUzh-Dd44/od6/public/values?alt=json-in-script&callback=sheetLoaded"></script>
-->
  <script src="https://spreadsheets.google.com/feeds/cells/1mGzL4Ap4kb0Xm0MUoZDUKcabsxPk5on-4UzMKkqlNF4/od6/public/values?alt=json-in-script&callback=sheetLoaded"></script>
  <script src="https://spreadsheets.google.com/feeds/cells/1mGzL4Ap4kb0Xm0MUoZDUKcabsxPk5on-4UzMKkqlNF4/ob8x97u/public/values?alt=json-in-script&callback=sheetLoaded"></script>
  <script src="https://spreadsheets.google.com/feeds/cells/1mGzL4Ap4kb0Xm0MUoZDUKcabsxPk5on-4UzMKkqlNF4/oide8um/public/values?alt=json-in-script&callback=sheetLoaded"></script>
  <script src="https://spreadsheets.google.com/feeds/cells/1mGzL4Ap4kb0Xm0MUoZDUKcabsxPk5on-4UzMKkqlNF4/oh5ekx4/public/values?alt=json-in-script&callback=sheetLoaded"></script>
  <script src="https://spreadsheets.google.com/feeds/cells/1mGzL4Ap4kb0Xm0MUoZDUKcabsxPk5on-4UzMKkqlNF4/og9xpl2/public/values?alt=json-in-script&callback=sheetLoaded"></script>
  <script src="https://spreadsheets.google.com/feeds/cells/1mGzL4Ap4kb0Xm0MUoZDUKcabsxPk5on-4UzMKkqlNF4/ow4t00h/public/values?alt=json-in-script&callback=sheetLoaded"></script>


  <script>
    var tf = new TableFilter(document.querySelector('#table'), {
      col_0: "select",
      col_1: "none",
      col_2: "select",
      col_3: "none",
      col_4: "none",
      extensions: [{ name: 'sort' }]
    });
    tf.init();
  </script>
  </body>
</html>